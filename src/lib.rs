extern crate cfg_if;
extern crate wasm_bindgen;
extern crate cgmath;
extern crate spade;

use cfg_if::cfg_if;
use wasm_bindgen::prelude::*;
use cgmath::Point2;
use cgmath::prelude::MetricSpace;
use spade::HasPosition;
use spade::delaunay::{DelaunayTriangulation,DelaunayWalkLocate};
use spade::kernels::FloatKernel;

cfg_if! {
    // When the `wee_alloc` feature is enabled, use `wee_alloc` as the global
    // allocator.
    if #[cfg(feature = "wee_alloc")] {
        extern crate wee_alloc;
        #[global_allocator]
        static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;
    }
}

#[wasm_bindgen]
pub fn add(first: i32, second:i32) -> i32 {
    first + second
}

#[wasm_bindgen]
pub fn sub(first: i32, second:i32) -> i32 {
    first - second
}

#[wasm_bindgen]
pub fn mul(first: f32, second: f32) -> f32 {
    first * second
}

/**
 *  `positions` is an array of the form [lat1,lng1,lat2,lng2,...]
 *  The return value is a run-length encoded array of cluster members, i.e.:
 *    [len1,x1,y1,member1-1,member1-2,...,len2,x2,y2,member2-1,member2-2,...]
 */
#[wasm_bindgen]
pub fn cluster(positions: Vec<f32>, threshold: f32, zoom_level: f32) -> Vec<i32> {
    let thresh2 = threshold.powf(2.0);
    let mut triangulation = DelaunayTriangulation::<Cluster, FloatKernel, DelaunayWalkLocate>::new();

    {
        let mut i = 0;
        for chunk in positions.chunks_exact(2) {
            let cluster = Cluster::create(chunk[0], chunk[1], zoom_level, i);
            triangulation.insert(cluster);
            i += 1;
        }
    }

    // do clustering
    loop {
        let next = Cluster::merge_closest(&mut triangulation);

        match next {
            None => break,
            Some((a,b,d)) => {
                if d >= thresh2 {
                    break;
                }

                let mut pa = triangulation.locate_and_remove(&a).unwrap();
                let pb = triangulation.locate_and_remove(&b).unwrap();

                pa.merge(pb);

                // insert merged cluster
                triangulation.insert(pa);
            }
        }
    }

    // create return vector
    let mut retval: Vec<i32> = vec![];
    for cluster in triangulation.vertices() {
        retval.push(cluster.members.len() as i32);
        retval.push(cluster.point.x.round() as i32);
        retval.push(cluster.point.y.round() as i32);

        retval.extend(&cluster.members);
    }

    return retval;
}

struct Cluster {
    point: Point2<f32>,
    members: Vec<i32>,
}

impl Cluster {
    fn create(lat: f32, lng: f32, zoom_level: f32, index: i32) -> Cluster {
        let lat = std::f32::consts::PI / 180_f32 * lat;
        let lng = std::f32::consts::PI / 180_f32 * lng;

        let x = 256_f32 / (2_f32 * std::f32::consts::PI) * 2_f32.powf(zoom_level)
            * (lng + std::f32::consts::PI);
        let y = 256_f32 / (2_f32 * std::f32::consts::PI) * 2_f32.powf(zoom_level)
            * (std::f32::consts::PI - (std::f32::consts::PI * 0.25 + lat * 0.5).tan().ln());

        let members = vec![index];
        let point = Point2::new(x, y);

        Cluster {point, members}
    }

    fn merge(self: &mut Cluster, other: Cluster) {
        let la = self.members.len();
        let lb = other.members.len();

        let x: f32 = ((la as f32) * self.point.x + (lb as f32) * other.point.x) / ((la + lb) as f32);
        let y: f32 = ((la as f32) * self.point.y + (lb as f32) * other.point.y) / ((la + lb) as f32);

        self.members.extend(&(other.members));
        self.point.x = x;
        self.point.y = y;
    }

    fn distance2(self: &Cluster, other: &Cluster) -> f32 {
        self.point.distance2(other.point)
    }

    fn merge_closest(triangulation: &mut DelaunayTriangulation<Cluster, FloatKernel, DelaunayWalkLocate>) -> Option<(Point2<f32>, Point2<f32>, f32)> {
        if triangulation.num_vertices() < 2 {
            return None;
        }

        let mut a = None;
        let mut b = None;
        let mut dist = f32::MAX;

        for edge in triangulation.edges() {
            let ca = &*edge.from();
            let cb = &*edge.to();
            let d2 = ca.distance2(&cb);

            if d2 < dist {
                a = Some(edge.from());
                b = Some(edge.to());
                dist = d2;
            }
        }

        // do this via the locations, because we had lifetime issues when removing both vertices
        // after each other (handles get invalidated)

        let pa = (*(a.unwrap())).point;
        let pb = (*(b.unwrap())).point;

        Some((pa, pb, dist))
    }
}

impl HasPosition for Cluster {
  type Point = Point2<f32>;
    fn position(&self) -> Point2<f32> {
      self.point
    }
}

#[cfg(test)]
mod tests {
    #[test]
    fn works() {
        let x = super::cluster(vec![0.3,0.5], 4.0, 6.0);
    }

    #[test]
    fn test_real_data() {
        let poss = vec![ 32.921817779541016,
        35.06887435913086,
        31.83329963684082,
        47.150001525878906,
        31.316699981689453,
        48.70000076293945,
        35.22521209716797,
        43.419368743896484,
        32.54449462890625,
        45.40745162963867,
        30.39430046081543,
        47.698699951171875,
        36.19932556152344,
        37.16300964355469,
        31.201435089111328,
        29.909772872924805,
        37.91061782836914,
        40.23686981201172,
        38.343753814697266,
        37.96411895751953,
        37.963417053222656,
        41.348289489746094,
        34.00666427612305,
        36.20368576049805,
        36.51415252685547,
        42.726566314697266,
        35.4161262512207,
        43.67889404296875,
        32.28046417236328,
        48.5176887512207,
        34.799293518066406,
        48.512210845947266,
        34.877220153808594,
        44.63833236694336,
        36.864444732666016,
        39.032779693603516,
        38.19444274902344,
        41.491111755371094,
        34.34579849243164,
        62.18830108642578,
        37.712799072265625,
        41.415199279785156,
        31.883333206176758,
        44.45000076293945,
        32.651390075683594,
        51.67919158935547,
        29.98080062866211,
        52.909400939941406,
        33.88529968261719,
        49.35279846191406,
        35.46630096435547,
        44.3922004699707,
        30.894691467285156,
        47.57802963256836,
        32.186180114746094,
        46.29969024658203,
        36.987491607666016,
        40.427040100097656,
        36.53333282470703,
        37.95000076293945,
        38.1422004699707,
        41.00130081176758,
        37.312904357910156,
        40.733951568603516,
        37.664398193359375,
        62.17470169067383,
        36.95790100097656,
        35.62419891357422,
        32.11666488647461,
        45.16666793823242,
        34.190879821777344,
        48.37445831298828,
        36.359439849853516,
        43.15277862548828,
        37.06666946411133,
        41.216670989990234,
        33.48777770996094,
        48.355831146240234,
        36.32133865356445,
        41.85956573486328,
        24.340900421142578,
        56.74039840698242,
        36.7746467590332,
        43.012237548828125,
        37.377464294433594,
        42.338951110839844,
        36.86470031738281,
        42.98970031738281,
        34.599998474121094,
        43.68333053588867,
        33.780601501464844,
        44.31241989135742,
        28.690200805664062,
        54.47809982299805,
        36.29999923706055,
        59.599998474121094,
        32.034400939941406,
        44.4031982421875,
        36.76744079589844,
        66.90125274658203,
        30.783050537109375,
        47.70515823364258,
        37.4032096862793,
        42.04621124267578,
        26.56909942626953,
        50.066001892089844,
        37.32500076293945,
        42.195831298828125,
        36.19111251831055,
        44.0091667175293,
        34.446998596191406,
        35.81782913208008,
        34.856109619140625,
        35.85832977294922,
        25.372100830078125,
        49.59550094604492,
        26.51449966430664,
        50.02040100097656,
        37.0277214050293,
        54.043270111083984,
        32.376712799072266,
        62.11927032470703,
        34.38560104370117,
        45.15380096435547,
        35.49259948730469,
        43.83610153198242,
        33.822601318359375,
        44.24470138549805,
        36.82583999633789,
        40.04962158203125,
        36.77640151977539,
        42.644901275634766,
        37.552738189697266,
        45.0760498046875,
        38.08333206176758,
        46.28333282470703,
        39.656497955322266,
        66.94721984863281,
        15.354720115661621,
        44.206668853759766,
        35.30048370361328,
        46.0421142578125,
        29.590484619140625,
        52.575653076171875,
        33.523372650146484,
        44.37643814086914,
        35.594268798828125,
        51.44716262817383,
        30.341079711914062,
        50.222171783447266,
        36.94839859008789,
        41.970001220703125,
        32.613800048828125,
        44.38650131225586,
        36.99495315551758,
        35.33250045776367,
        34.372222900390625,
        41.98749923706055,
        35.417999267578125,
        36.39799880981445,
        36.43000030517578,
        42.600799560546875,
        32.51789855957031,
        36.482601165771484,
        33.24752426147461,
        35.69346237182617,
        35.95000076293945,
        39.016700744628906,
        29.77777862548828,
        51.570831298828125,
        40.88656997680664,
        71.45059967041016,
        30.534799575805664,
        31.717300415039062,
        32.616668701171875,
        36.099998474121094,
        26.56488800048828,
        31.745176315307617,
        36.769676208496094,
        35.789485931396484,
        37.38861083984375,
        46.24055480957031,
        36.469722747802734,
        52.350833892822266,
        30.913368225097656,
        31.23879623413086,
        37.20349884033203,
        42.53810119628906,
        37.26380157470703,
        35.90549850463867,
        38.25,
        36.91666793823242,
        38.66086959838867,
        39.510921478271484,
        32.314998626708984,
        48.149253845214844,
        33.720340728759766,
        44.415924072265625,
        38.20209884643555,
        44.77050018310547,
        25.88111114501953,
        68.77694702148438,
        36.303611755371094,
        43.412776947021484,
        36.83639144897461,
        43.46477127075195,
        36.84138870239258,
        43.48527908325195,
        37.96027755737305,
        42.51499938964844
            ];

        let x = super::cluster(poss, 48.0, 4.0);
        print!("{:?}\n", x);
    }

    #[test]
    fn test_real_data_2() {
        let poss = vec![ 36.334999084472656,
        43.11888885498047,
        32.921817779541016,
        35.06887435913086,
        31.83329963684082,
        47.150001525878906,
        27.043245315551758,
        31.32018280029297,
        26.56488800048828,
        31.745176315307617,
        36.99495315551758,
        35.33250045776367,
        32.616668701171875,
        36.099998474121094,
        29.085498809814453,
        30.93459129333496,
        31.316699981689453,
        48.70000076293945,
        33.523372650146484,
        44.37643814086914,
        36.19932556152344,
        37.16300964355469,
        32.50173568725586,
        44.86365509033203,
        35.22521209716797,
        43.419368743896484,
        32.54449462890625,
        45.40745162963867,
        30.39430046081543,
        47.698699951171875,
        32.613800048828125,
        44.38650131225586,
        31.201435089111328,
        29.909772872924805,
        37.91061782836914,
        40.23686981201172,
        37.26380157470703,
        35.90549850463867,
        33.37861251831055,
        43.7158317565918,
        34.372222900390625,
        41.98749923706055,
        36.20159912109375,
        36.165199279785156,
        37.025428771972656,
        37.97877502441406,
        35.417999267578125,
        36.39799880981445,
        29.40842056274414,
        31.251670837402344,
        24.97743034362793,
        32.872379302978516,
        32.376712799072266,
        62.11927032470703,
        38.25,
        36.91666793823242,
        38.343753814697266,
        37.96411895751953,
        38.66086959838867,
        39.510921478271484,
        37.963417053222656,
        41.348289489746094,
        27.178829193115234,
        31.178489685058594,
        30.47056007385254,
        31.188060760498047,
        34.00666427612305,
        36.20368576049805,
        33.32500076293945,
        44.422000885009766,
        36.51415252685547,
        42.726566314697266,
        26.245180130004883,
        32.006160736083984,
        35.4161262512207,
        43.67889404296875,
        35.04499816894531,
        43.5724983215332,
        30.568260192871094,
        31.51590919494629,
        32.5,
        34.89971923828125,
        35.156761169433594,
        40.42573928833008,
        36.46527862548828,
        34.15416717529297,
        31.01704978942871,
        30.448720932006836,
        34.601951599121094,
        47.49055099487305,
        33.51300048828125,
        36.29199981689453,
        35.13922882080078,
        44.44906997680664,
        37.17898941040039,
        40.95491027832031,
        37.32817459106445,
        41.3415412902832,
        37.150001525878906,
        37.366668701171875,
        37.15119934082031,
        38.78990173339844,
        34.730831146240234,
        36.709442138671875,
        37.956600189208984,
        39.01649856567383,
        36.81805419921875,
        38.0099983215332,
        32.28046417236328,
        48.5176887512207,
        37.32500076293945,
        42.195831298828125,
        38.43949890136719,
        38.81420135498047,
        37.70510482788086,
        37.42580032348633,
        36.020538330078125,
        43.39249038696289,
        37.5,
        41.46799850463867,
        34.799293518066406,
        48.512210845947266,
        37.31719970703125,
        35.81740188598633,
        34.877220153808594,
        44.63833236694336,
        36.864444732666016,
        39.032779693603516,
        38.34703063964844,
        40.75218200683594,
        38.19444274902344,
        41.491111755371094,
        33.663700103759766,
        36.249000549316406,
        34.34579849243164,
        62.18830108642578,
        38.70349884033203,
        39.25709915161133,
        37.75971984863281,
        38.278751373291016,
        38.62472152709961,
        38.1349983215332,
        37.712799072265625,
        41.415199279785156,
        34.46110916137695,
        45.86277770996094,
        31.883333206176758,
        44.45000076293945,
        25.293609619140625,
        32.55638885498047,
        32.651390075683594,
        51.67919158935547,
        29.98080062866211,
        52.909400939941406,
        31.7833309173584,
        35.216670989990234,
        30.045726776123047,
        31.235870361328125,
        33.88529968261719,
        49.35279846191406,
        35.46630096435547,
        44.3922004699707,
        32.314998626708984,
        48.149253845214844,
        30.894691467285156,
        47.57802963256836,
        34.88811492919922,
        43.5492057800293,
        32.186180114746094,
        46.29969024658203,
        29.62712287902832,
        51.651817321777344,
        35.5,
        36.58330154418945,
        36.987491607666016,
        40.427040100097656,
        36.3583984375,
        42.79359817504883,
        36.4900016784668,
        43.442901611328125,
        36.74416732788086,
        36.95916748046875,
        35.51667022705078,
        35.783329010009766,
        37.96659851074219,
        38.599998474121094,
        30.121580123901367,
        31.13460922241211,
        36.53333282470703,
        37.95000076293945,
        38.1422004699707,
        41.00130081176758,
        37.58330154418945,
        36.93330001831055,
        37.312904357910156,
        40.733951568603516,
        36.4906005859375,
        43.44240188598633,
        37.664398193359375,
        62.17470169067383,
        38.34767150878906,
        38.31462860107422,
        36.95790100097656,
        35.62419891357422,
        32.11666488647461,
        45.16666793823242,
        34.190879821777344,
        48.37445831298828,
        36.359439849853516,
        43.15277862548828,
        36.2140007019043,
        58.79600143432617,
        37.06666946411133,
        41.216670989990234,
        27.148399353027344,
        57.07339859008789,
        35.926124572753906,
        38.55474090576172,
        35.95000076293945,
        39.016700744628906,
        37.321983337402344,
        41.538448333740234,
        35.99861145019531,
        36.99805450439453,
        37.54833221435547,
        40.959720611572266,
        38.293304443359375,
        38.958194732666016,
        37.42705535888672,
        37.69233322143555,
        35.594268798828125,
        51.44716262817383,
        35.02510070800781,
        40.45289993286133,
        36.82583999633789,
        40.04962158203125,
        35.62899398803711,
        38.757591247558594,
        30.341079711914062,
        50.222171783447266,
        34.31650161743164,
        36.927223205566406,
        37.483890533447266,
        41.40250015258789,
        38.20209884643555,
        44.77050018310547,
        39.656497955322266,
        66.94721984863281,
        37.56452178955078,
        38.47134017944336,
        36.97639083862305,
        38.426944732666016,
        35.27622985839844,
        36.58391189575195,
        29.77777862548828,
        51.570831298828125,
        29.590484619140625,
        52.575653076171875,
        32.202850341796875,
        48.25307083129883,
        32.04999923706055,
        48.849998474121094,
        37.75,
        39.31666564941406,
        33.094444274902344,
        44.522220611572266,
        33.48777770996094,
        48.355831146240234,
        38.73360061645508,
        36.22330093383789,
        36.32133865356445,
        41.85956573486328,
        27.666667938232422,
        52.342498779296875,
        29.36684226989746,
        55.76299285888672,
        24.340900421142578,
        56.74039840698242,
        34.599998474121094,
        43.68333053588867,
        36.91860580444336,
        34.88373565673828,
        38.08333206176758,
        46.28333282470703,
        37.06719970703125,
        36.14759826660156,
        37.2322998046875,
        39.76237869262695,
        36.87409973144531,
        37.558799743652344,
        37.32978820800781,
        40.25865936279297,
        36.7746467590332,
        43.012237548828125,
        37.377464294433594,
        42.338951110839844,
        32.796600341796875,
        35.53572082519531,
        37.08140182495117,
        37.8489990234375,
        37.552738189697266,
        45.0760498046875,
        30.99839973449707,
        61.84870147705078,
        37.05833053588867,
        37.86582946777344,
        38.09482955932617,
        37.885929107666016,
        33.09968185424805,
        45.9368782043457,
        33.1279296875,
        47.36669921875,
        36.86470031738281,
        42.98970031738281,
        33.780601501464844,
        44.31241989135742,
        32.94440841674805,
        46.4693489074707,
        28.690200805664062,
        54.47809982299805,
        37.251365661621094,
        36.46696853637695,
        37.56050109863281,
        37.85580062866211,
        38.03158187866211,
        36.49834060668945,
        38.47480010986328,
        36.83539962768555,
        39.0796012878418,
        37.21220016479492,
        37.34230041503906,
        34.94430160522461,
        38.54722213745117,
        37.511112213134766,
        38.34489822387695,
        36.8286018371582,
        38.32952117919922,
        36.325889587402344,
        35.08330154418945,
        38.91659927368164,
        36.97562026977539,
        36.13447189331055,
        34.96017074584961,
        36.735111236572266,
        36.266666412353516,
        36.56666564941406,
        35.18330001831055,
        35.95000076293945,
        35.98701477050781,
        38.11131286621094,
        37.13399887084961,
        37.139801025390625,
        35.136600494384766,
        36.7495002746582,
        35.36000061035156,
        35.92020034790039,
        36.55500030517578,
        38.26169967651367,
        37.73500061035156,
        36.53919982910156,
        36.207298278808594,
        36.51919937133789,
        35.68330001831055,
        36.53329849243164,
        34.934600830078125,
        36.39670181274414,
        36.12379837036133,
        35.92190170288086,
        36.085140228271484,
        35.97969055175781,
        35.369720458984375,
        36.380001068115234,
        36.10279846191406,
        36.19110107421875,
        36.65556335449219,
        33.129852294921875,
        36.769676208496094,
        35.789485931396484,
        36.02061080932617,
        32.80167007446289,
        37.51008224487305,
        35.36869812011719,
        36.67770004272461,
        33.480079650878906,
        36.48112106323242,
        32.89952850341797,
        37.814693450927734,
        36.40833282470703,
        37.17723083496094,
        36.18724822998047,
        36.144081115722656,
        33.32305908203125,
        36.65167999267578,
        33.441558837890625,
        36.53084182739258,
        32.471458435058594,
        37.1703987121582,
        34.60380172729492,
        36.240699768066406,
        32.45035934448242,
        37.709999084472656,
        36.84479904174805,
        37.34230041503906,
        34.94430160522461,
        36.5536994934082,
        32.55569839477539,
        36.58518981933594,
        33.95669174194336,
        36.62276840209961,
        33.025089263916016,
        37.36648178100586,
        36.10157012939453,
        36.74489974975586,
        34.54227828979492,
        36.48649978637695,
        34.00464630126953,
        36.419559478759766,
        35.88768005371094,
        36.38121032714844,
        33.924129486083984,
        36.258270263671875,
        32.282958984375,
        37.44268035888672,
        35.809268951416016,
        36.104148864746094,
        33.017478942871094,
        36.09400939941406,
        32.810890197753906,
        36.699798583984375,
        32.690521240234375,
        36.80863952636719,
        34.63806915283203,
        37.72639846801758,
        36.8744010925293,
        37.66400146484375,
        35.80849838256836,
        37.859100341796875,
        35.94900131225586,
        37.00120162963867,
        34.566898345947266,
        37.50210189819336,
        35.314300537109375,
        36.4647102355957,
        59.540462493896484,
        36.29999923706055,
        59.599998474121094,
        32.034400939941406,
        44.4031982421875,
        36.76744079589844,
        66.90125274658203,
        30.783050537109375,
        47.70515823364258,
        37.4032096862793,
        42.04621124267578,
        33.88669967651367,
        44.91939926147461,
        26.56909942626953,
        50.066001892089844,
        36.89759826660156,
        42.42940139770508,
        33.89331817626953,
        35.50157165527344,
        36.19111251831055,
        44.0091667175293,
        34.446998596191406,
        35.81782913208008,
        34.856109619140625,
        35.85832977294922,
        37.23255920410156,
        55.14543914794922,
        34.56999969482422,
        38.29209899902344,
        34.25583267211914,
        35.656944274902344,
        33.56024169921875,
        35.37120819091797,
        25.372100830078125,
        49.59550094604492,
        38.41790008544922,
        38.76860046386719,
        26.51449966430664,
        50.02040100097656,
        37.0277214050293,
        54.043270111083984,
        37.41830062866211,
        41.362300872802734,
        33.720340728759766,
        44.415924072265625,
        33.63740158081055,
        42.82640075683594,
        34.38560104370117,
        45.15380096435547,
        35.49259948730469,
        43.83610153198242,
        33.268070220947266,
        35.20935821533203,
        34.15409851074219,
        36.74789810180664,
        33.96666717529297,
        36.66666793823242,
        33.724998474121094,
        36.09722137451172,
        33.695831298828125,
        36.377498626708984,
        33.822601318359375,
        44.24470138549805,
        26.477378845214844,
        31.802799224853516,
        30.913368225097656,
        31.23879623413086,
        30.839500427246094,
        30.865999221801758,
        30.748199462890625,
        30.670299530029297,
        27.8080997467041,
        30.87929916381836,
        26.898569107055664,
        31.518220901489258,
        27.77457046508789,
        30.808080673217773,
        24.08292007446289,
        32.89065933227539,
        31.0802001953125,
        31.07390022277832,
        31.121599197387695,
        31.44420051574707,
        30.881999969482422,
        31.2322998046875,
        30.40523910522461,
        31.56856918334961,
        30.890199661254883,
        30.307600021362305,
        31.164100646972656,
        31.43199920654297,
        31.58612060546875,
        30.99605941772461,
        30.683332443237305,
        31.350000381469727,
        31.169300079345703,
        31.03619956970215,
        31.127099990844727,
        31.364999771118164,
        26.141700744628906,
        32.67000961303711,
        31.0093994140625,
        31.978500366210938,
        30.725929260253906,
        31.025009155273438,
        26.002580642700195,
        32.31195831298828,
        30.012100219726562,
        31.213499069213867,
        31.417068481445312,
        31.81258773803711,
        31.203258514404297,
        30.55035400390625,
        31.200559616088867,
        32.234718322753906,
        27.142499923706055,
        31.238000869750977,
        28.478639602661133,
        30.784860610961914,
        30.97559928894043,
        30.952899932861328,
        25.996400833129883,
        32.81578826904297,
        25.916669845581055,
        32.75,
        27.43899917602539,
        30.817899703979492,
        31.025400161743164,
        30.60580062866211,
        30.970630645751953,
        31.166900634765625,
        30.46596908569336,
        30.931989669799805,
        31.155420303344727,
        30.486740112304688,
        30.87470054626465,
        30.831899642944336,
        31.48699951171875,
        30.687000274658203,
        30.985599517822266,
        31.301000595092773,
        28.53611183166504,
        30.655555725097656,
        31.405000686645508,
        30.417299270629883,
        30.638999938964844,
        31.285999298095703,
        30.970630645751953,
        31.166900634765625,
        31.06999969482422,
        30.548500061035156,
        30.967159271240234,
        30.769500732421875,
        30.960399627685547,
        31.242900848388672,
        31.512699127197266,
        30.931299209594727,
        30.596599578857422,
        30.899999618530273,
        28.189170837402344,
        30.69805908203125,
        29.93589973449707,
        31.26409912109375,
        28.62969970703125,
        30.785400390625,
        30.78420066833496,
        30.997600555419922,
        30.939729690551758,
        31.51711082458496,
        30.977699279785156,
        31.45155906677246,
        25.700300216674805,
        32.645198822021484,
        31.088890075683594,
        30.947330474853516,
        25.622119903564453,
        32.54433059692383,
        31.08919906616211,
        31.630800247192383,
        31.866666793823242,
        44.45000076293945,
        34.63990020751953,
        50.87590026855469,
        31.92972183227539,
        34.86277770996094,
        32.9658317565918,
        35.49833297729492,
        15.354720115661621,
        44.206668853759766,
        30.806650161743164,
        31.20616912841797,
        31.09248924255371,
        31.14801025390625,
        33.98149871826172,
        35.618099212646484,
        35.0595817565918,
        44.35166931152344,
        33.983890533447266,
        51.4363899230957,
        32.51789855957031,
        36.482601165771484,
        35.30048370361328,
        46.0421142578125,
        41.33333206176758,
        69.30000305175781,
        36.77640151977539,
        42.644901275634766,
        26.632104873657227,
        61.2584342956543,
        31.275379180908203,
        49.60435485839844,
        37.40861129760742,
        42.06611251831055,
        36.9552001953125,
        41.506500244140625,
        36.94839859008789,
        41.970001220703125,
        36.43000030517578,
        42.600799560546875,
        37.27220153808594,
        37.8380012512207,
        31.135900497436523,
        30.19059944152832,
        33.24752426147461,
        35.69346237182617,
        36.352359771728516,
        43.37989044189453,
        37.16569900512695,
        41.38779830932617,
        38.09157943725586,
        42.153900146484375,
        36.380699157714844,
        42.4473991394043,
        31.666667938232422,
        34.56666564941406,
        32.21651077270508,
        35.26293182373047,
        39.766666412353516,
        64.43333435058594,
        33.54999923706055,
        68.41666412353516,
        32.481109619140625,
        44.43583297729492,
        34.53333282470703,
        69.16666412353516,
        32.498329162597656,
        20.892780303955078,
        16.935832977294922,
        43.764442443847656,
        31.50395965576172,
        34.46202850341797,
        34.12361145019531,
        35.6511116027832,
        38.24611282348633,
        48.29499816894531,
        25.88111114501953,
        68.77694702148438,
        14.199999809265137,
        43.31666564941406,
        36.469722747802734,
        52.350833892822266,
        41.68194580078125,
        60.726112365722656,
        42.325279235839844,
        59.157501220703125,
        31.704870223999023,
        35.203758239746094,
        31.52935028076172,
        35.09379959106445,
        32.699249267578125,
        35.30482864379883,
        30.32982063293457,
        35.44144058227539,
        31.672300338745117,
        48.905601501464844,
        32.2761116027832,
        35.19499969482422,
        34.883331298828125,
        35.883331298828125,
        30.28333282470703,
        57.08333206176758,
        36.58409881591797,
        33.92570114135742,
        36.75088119506836,
        32.753910064697266,
        36.64012145996094,
        32.89442825317383,
        37.57057189941406,
        48.559810638427734,
        36.16666793823242,
        54.349998474121094,
        34.20722198486328,
        43.880279541015625,
        31.502300262451172,
        64.35679626464844,
        40.88656997680664,
        71.45059967041016,
        34.340599060058594,
        61.49409866333008,
        30.653888702392578,
        50.274723052978516,
        35.676734924316406,
        63.289794921875,
        33.72666549682617,
        59.184444427490234,
        39.770164489746094,
        68.79877471923828,
        34.82320022583008,
        67.83580017089844,
        38.274600982666016,
        67.89510345458984,
        42.30120086669922,
        69.75779724121094,
        35.921390533447266,
        64.78360748291016,
        26.970470428466797,
        64.0893325805664,
        30.200000762939453,
        71.45999908447266,
        27.776500701904297,
        66.5949478149414,
        21.422399520874023,
        39.82609939575195,
        30.709999084472656,
        48.647300720214844,
        29.108333587646484,
        58.358333587646484,
        28.67009925842285,
        57.73889923095703,
        28.952159881591797,
        58.697731018066406,
        31.049917221069336,
        32.600128173828125,
        26.616666793823242,
        37.91666793823242,
        24.467500686645508,
        39.61130142211914,
        17.136573791503906,
        42.442073822021484,
        14.762628555297852,
        49.60974884033203,
        30.534799575805664,
        31.717300415039062,
        30.494199752807617,
        47.818599700927734,
        29.320880889892578,
        30.835830688476562,
        30.683059692382812,
        31.355560302734375,
        38.204498291015625,
        37.18960189819336,
        38.180198669433594,
        37.0786018371582,
        37.38861083984375,
        46.24055480957031,
        37.03972244262695,
        45.098331451416016,
        36.434722900390625,
        48.79750061035156,
        30.623451232910156,
        31.042339324951172,
        30.713911056518555,
        31.26144027709961,
        28.09471321105957,
        30.756528854370117,
        30.139497756958008,
        31.29068374633789,
        37.6370735168457,
        35.60566329956055,
        38.432777404785156,
        45.775001525878906,
        37.80164337158203,
        36.790775299072266,
        37.86677932739258,
        36.98616409301758,
        31.60774040222168,
        34.89411926269531,
        37.193603515625,
        32.34244155883789,
        31.266666412353516,
        35.733333587646484,
        32.5,
        35.5,
        36.15330123901367,
        32.42913818359375,
        39.057777404785156,
        66.83416748046875,
        28.712499618530273,
        33.611942291259766,
        31.183156967163086,
        35.703277587890625,
        31.301347732543945,
        30.301715850830078,
        30.199722290039062,
        31.205278396606445,
        29.186325073242188,
        31.13277816772461,
        31.78673553466797,
        35.80104064941406,
        25.899999618530273,
        32.71666717529297,
        30.882299423217773,
        31.32040023803711,
        26.154447555541992,
        32.715087890625,
        32.08333206176758,
        34.79999923706055,
        31.252798080444336,
        31.680273056030273,
        30.411762237548828,
        30.85348129272461,
        34.55781173706055,
        36.51959991455078,
        36.75245666503906,
        32.69778823852539,
        31.71733856201172,
        35.79452133178711,
        22.200000762939453,
        31.46666717529297,
        31.950000762939453,
        35.93333435058594,
        24.0250301361084,
        32.88425064086914,
        36.7136344909668,
        32.797550201416016,
        38.893798828125,
        65.80850219726562,
        37.77888870239258,
        69.55555725097656,
        36.48027801513672,
        32.81944274902344,
        36.71338653564453,
        33.46620178222656,
        40.88130187988281,
        69.68499755859375,
        36.208248138427734,
        40.72041702270508,
        31.027273178100586,
        35.48181915283203,
        37.20349884033203,
        42.53810119628906,
        36.303611755371094,
        43.412776947021484,
        36.83639144897461,
        43.46477127075195,
        36.84138870239258,
        43.48527908325195,
        37.96027755737305,
        42.51499938964844
            ];

        let x = super::cluster(poss, 48.0, 4.0);
        print!("{:?}\n", x);
    }
}
